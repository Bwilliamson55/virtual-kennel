import{a as q,Q as V,b as P,c as A}from"./QCard.84f853b7.js";import{c as L,r as v,E as N,a5 as I,ae as k,o as D,h as M,d as O,g as U,a6 as j,B,f as K,af as T,S as Y,ag as $,ah as z,K as Q,L as F,M as m,N as c,Y as R,U as G,P as H,R as J,O as W}from"./index.86a4347e.js";import{Q as X}from"./QPage.08bcdd98.js";import{b as Z}from"./useNotification.a2441337.js";var ee=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(l,{slots:d,emit:i}){const p=U(),s=v(null);let n=0;const r=[];function y(e){const a=typeof e=="boolean"?e:l.noErrorFocus!==!0,S=++n,_=(t,o)=>{i("validation"+(t===!0?"Success":"Error"),o)},w=t=>{const o=t.validate();return typeof o.then=="function"?o.then(u=>({valid:u,comp:t}),u=>({valid:!1,comp:t,err:u})):Promise.resolve({valid:o,comp:t})};return(l.greedy===!0?Promise.all(r.map(w)).then(t=>t.filter(o=>o.valid!==!0)):r.reduce((t,o)=>t.then(()=>w(o).then(u=>{if(u.valid===!1)return Promise.reject(u)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return S===n&&_(!0),!0;if(S===n){const{comp:o,err:u}=t[0];if(u!==void 0&&console.error(u),_(!1,o),a===!0){const C=t.find(({comp:E})=>typeof E.focus=="function"&&j(E.$)===!1);C!==void 0&&C.comp.focus()}}return!1})}function b(){n++,r.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function g(e){e!==void 0&&B(e);const a=n+1;y().then(S=>{a===n&&S===!0&&(l.onSubmit!==void 0?i("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function x(e){e!==void 0&&B(e),i("reset"),K(()=>{b(),l.autofocus===!0&&l.noResetFocus!==!0&&f()})}function f(){q(()=>{if(s.value===null)return;const e=s.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||s.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||s.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(s.value.querySelectorAll("[tabindex]"),a=>a.tabIndex>-1);e!=null&&e.focus({preventScroll:!0})})}N(T,{bindComponent(e){r.push(e)},unbindComponent(e){const a=r.indexOf(e);a>-1&&r.splice(a,1)}});let h=!1;return I(()=>{h=!0}),k(()=>{h===!0&&l.autofocus===!0&&f()}),D(()=>{l.autofocus===!0&&f()}),Object.assign(p.proxy,{validate:y,resetValidation:b,submit:g,reset:x,focus:f,getValidationComponents:()=>r}),()=>M("form",{class:"q-form",ref:s,onSubmit:g,onReset:x},O(d.default))}});const te=R("div",{class:"text-h6 text-center"},"Login",-1),ae={class:"q-mt-md"},le={__name:"LoginPage",setup(l){const d=v(""),i=v(""),p=v(!1),s=v(!1),n=v(""),r=Y(),{showSuccess:y,showError:b}=Z(),g=$();z(()=>{r.isAuthenticated&&g.push({name:"dashboard"})});const x=async()=>{p.value=!0,s.value=!1;try{await r.login(d.value,i.value),y("Logged in successfully"),g.push({name:"dashboard"})}catch(h){s.value=!0,n.value=h.message||"Login failed",b(n.value)}finally{p.value=!1}},f=()=>{d.value="",i.value=""};return(h,e)=>(Q(),F(X,{class:"flex flex-center"},{default:m(()=>[c(A,{class:"q-pa-md",style:{width:"90%","max-width":"400px"}},{default:m(()=>[c(V,null,{default:m(()=>[te]),_:1}),c(V,null,{default:m(()=>[c(ee,{onSubmit:x,onReset:f},{default:m(()=>[c(P,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),label:"Email",type:"email"},null,8,["modelValue"]),c(P,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),label:"Password",type:"password"},null,8,["modelValue"]),R("div",ae,[c(G,{label:"Login",type:"submit",color:"primary",class:"full-width",loading:p.value},null,8,["loading"])])]),_:1})]),_:1}),s.value?(Q(),F(V,{key:0,class:"text-negative"},{default:m(()=>[H(J(n.value),1)]),_:1})):W("",!0)]),_:1})]),_:1}))}};export{le as default};
